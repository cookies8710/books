/sqrt3 {3 sqrt} def

% draws hexagon with center tx, ty, radius a and generated by bt 
% bt is expected to draw into the the base equilateral triangle area with side of size a - vertices [0, 0], [0, a], [a*sqrt(3)/2, a/2]
/hexagon 
{ 
	/a exch def
	/bt exch def
	/t exch def

	/tx {t 0 get} def
	/ty {t 1 get} def

	tx ty translate

	0 1 5 {
		bt
		60 rotate
	} for

	tx neg ty neg translate
} def


% todo nx, ny: 700, 600 should be taken from page size
%
% hexagon's circle radius
/a 20 def 
/nx {700 a 2 mul div} def
/ny {1200 a 2 mul div} def

% u -> 0 deg vector
/u {
	/pa exch def
	/x {pa sqrt3 mul} def
	[x 0]
} def

% v -> 60 deg vector
/v {
	/pa exch def
	/x {pa sqrt3 2 div mul} def
	/y {3 pa 2 div mul} def
	[x y]
} def

% vec1 vec2 -> vec1 + vec2
/add_vec { 
	/b exch def
	/aaa exch def
	/xs {aaa 0 get b 0 get add} def
	/ys {aaa 1 get b 1 get add} def
	[xs ys]
} def

% vec k -> k * vec
/mul_vec { 
	/k exch def
	/vec exch def
	/xs {k vec 0 get mul} def
	/ys {k vec 1 get mul} def
	[xs ys]
} def

% hexagon outline - just the outer line
/outline {
	/side exch def
	newpath
	0 side moveto 
	side sqrt3 2 div mul side 2 div lineto
	stroke
} def

% base tile for star pattern
/star {
	/side exch def
	/b {0.8 side mul} def
	/w {0.1 side mul} def
	/ex {b sqrt3 2 div mul} def
	/ey {b 2 div} def


	newpath
	0 b moveto % A = [0, b]
	w w sqrt3 mul lineto % C = [w, w/ tg 30]
	ex ey  lineto % E = [b * sqrt(3) / 2,b * sin 30]
	stroke
} def
%
% base tile for "asterisk" star
/asterisk {
	/side exch def
	/b {0.8 side mul} def
	/w {0.1 side mul} def
	/ex {b sqrt3 2 div mul} def
	/ey {b 2 div} def
	/dxx {ex w 0.5 mul sub} def
	/dyy {ey w sqrt3 2 div mul add} def

	newpath
	0 0 moveto
	0 b lineto % A = [0, b]
	w b lineto % B = [w, b]
	w w sqrt3 mul lineto % C = [w, w/ tg 30]
	dxx dyy lineto % D = 
	ex ey lineto % E = [b * sqrt(3) / 2,b * sin 30]
	0 0 lineto
	fill
	stroke
} def

0 1 ny {
	/dy exch def
	0 1 nx {
		/dx exch def
		/dx2 {dx dy 2 div floor sub} def % need to account for v's shift to right
		a u dx2 mul_vec a v dy mul_vec add_vec {a asterisk} a hexagon
	} for
} for

showpage
